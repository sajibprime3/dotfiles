#!/usr/bin/env bash

if [[ -z $LOCAL_OPT ]]; then
    local_opt=$HOME/opt # Default fallback
else
    local_opt=$LOCAL_OPT
fi

if [[ $# -eq 1 ]]; then
    selected=$1
else
    selected=$(find $local_opt -mindepth 1 -maxdepth 2 -type l | sed -e "s:$local_opt/\(.*\)/current:\1:" | fzf)
fi

if [[ -z $selected ]]; then
    exit 0
fi

selected_program_name=$(basename "$selected" | tr . _)

selected_version=$(find "$local_opt/$selected_program_name" -mindepth 1 -maxdepth 1 -type d | sed -e "s:$local_opt/.*/::" | fzf)
if [[ -z $selected_version ]]; then
    exit 0
fi
ln -sfn "$local_opt/$selected_program_name/$selected_version" "$local_opt/$selected_program_name/current"
